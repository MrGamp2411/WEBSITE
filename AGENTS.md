# AGENT Notes

- Core modules:
  - `main.py` – routes and helpers
  - `models.py` – data models
  - `database.py` – database utilities
  - `audit.py` – records user actions to `AuditLog`
  - `finance.py` – VAT and payout calculations
  - `payouts.py` – schedule periodic payouts for bars
- Front-end mapping:
  - Styles in `static/css/components.css` (`components.min.css` for minified)
  - Templates live under `templates/`
  - JavaScript: `static/js/app.js` (shared/carousels), `static/js/search.js`, `static/js/view-all.js`
  - Bar & product card size: 400×450 desktop, 300×400 mobile
  - Global footer: `templates/layout.html` uses `.site-footer` styled in `static/css/components.css`
- Bars:
  - `/bars` page uses `templates/all_bars.html` and `static/js/view-all.js`
  - `BAR_CATEGORIES` defined in `main.py`; reused in `search.js` and `view-all.js`
  - Categories stored in `bars.bar_categories`
  - Opening hours data is sanitized; invalid or non-dict values are treated as closed
  - Category `sort_order` defaults to `0` when missing to avoid menu sorting errors
  - Bar detail page uses bar-card metadata for rating and geolocated distance
  - Bar detail page displays the bar's description beneath the address
  - Bar detail page shows open/closed status using `bar.is_open_now`
  - Bar detail page uses the same `.status` classes as bar cards for open/closed labels
  - Bar detail page lists weekly opening hours beneath the description
  - Bar detail info is rendered in `.bar-detail` (no card styling)
  - Bar detail layout: `.bar-cover` image (16/9), `.bar-meta` row with status/rating/distance, `.clamp`ed description, and `.bar-hours-card` grid (Mon–Thu / Fri–Sun)
  - `.bar-detail` has `margin-bottom: var(--space-4)` to add space before product categories
  - Open status uses `.status-open` (green) and closed status uses `.status-closed` (red)
- Products:
  - Images stored in `menu_items.photo` and served via `/api/products/{id}/image`
  - `templates/bar_detail.html` shows products with carousels handled by `static/js/app.js`
- Users:
  - Credit stored in `users.credit`; ensured by `ensure_credit_column()` on startup
- Testing:
  - Run `pytest`
