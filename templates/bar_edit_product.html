{% extends "layout.html" %}
{% block content %}
{% set fallback_img = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCA0MDAgMjI1Jz48cmVjdCB3aWR0aD0nNDAwJyBoZWlnaHQ9JzIyNScgZmlsbD0nJTIzZjFmM2Y1Jy8+PC9zdmc+" %}
<h1>{{ _('bar_products.edit.title', product=product.name, default='Edit Product {product}') }}</h1>
<section class="product-edit">
  <div class="card">
    <div class="card__body">
      <form class="form" method="post" enctype="multipart/form-data">
        <div class="form-field locked-field">
          <label for="name">{{ _('bar_products.form.name', default='Name') }}</label>
          <p class="description-preview">{{ product.name }}</p>
          <input id="name" name="name" type="hidden" value="{{ product.name }}" required>
          <a class="btn-outline field-action" href="/bar/{{ bar.id }}/categories/{{ category.id }}/products/{{ product.id }}/edit/name">{{ _('bar_products.edit.actions.edit_name', default='Edit name') }}</a>
        </div>
        <div class="form-field">
          <label for="price">{{ _('bar_products.form.price', default='Price (CHF)') }}</label>
          <input id="price" type="number" step="0.01" name="price" value="{{ '%.2f'|format(product.price) }}" required>
        </div>
        <div class="form-field locked-field">
          <label for="description">{{ _('bar_products.form.description', default='Description') }}</label>
          <p class="description-preview">{{ product.description }}</p>
          <textarea id="description" name="description" hidden maxlength="190">{{ product.description }}</textarea>
          <a class="btn-outline field-action" href="/bar/{{ bar.id }}/categories/{{ category.id }}/products/{{ product.id }}/edit/description">{{ _('bar_products.edit.actions.edit_description', default='Edit description') }}</a>
        </div>
        <div class="form-field">
          <label for="display_order">{{ _('bar_products.form.display_order', default='Display Order') }}</label>
          <input id="display_order" type="number" name="display_order" value="{{ product.display_order }}">
        </div>
        <div class="form-field">
          <label>{{ _('bar_products.form.photo', default='Photo') }}</label>
          <div class="photo-preview">
            <img src="{{ product.photo_url }}" alt="{{ product.name }} photo" loading="lazy" decoding="async" onerror="this.src='{{ fallback_img }}';this.onerror=null;" width="400" height="225" />
          </div>
          <input id="photo" type="file" name="photo" accept="image/*">
        </div>
        <button class="btn btn--primary" type="submit">{{ _('bar_products.form.update', default='Update') }}</button>
      </form>
    </div>
  </div>
</section>
<style>
.product-edit{max-width:720px;margin-inline:auto;}
.product-edit .card{max-height:none;}
.product-edit .card__body{display:flex;}
.product-edit .form{display:flex;flex-direction:column;gap:var(--space-5,24px);width:100%;}
.product-edit .form-field{display:flex;flex-direction:column;gap:var(--space-2,12px);}
.product-edit .field-action{align-self:flex-start;}
.product-edit .locked-field .description-preview{margin:0;padding:12px 16px;border-radius:var(--radius-xl,16px);background:var(--surface-strong,#f3f4f6);font-size:0.95rem;line-height:1.5;}
.product-edit .locked-field .description-preview:empty::before{content:"";}
.product-edit .photo-preview{border-radius:var(--radius-xl,16px);overflow:hidden;max-width:200px;}
.product-edit .photo-preview img{display:block;width:100%;height:auto;}
</style>
{% endblock %}
