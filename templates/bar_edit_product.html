{% extends "layout.html" %}
{% block page_styles %}
{{ super() }}
<link rel="stylesheet" href="/static/css/pages/bar-edit-product.css">
{% endblock %}
{% block content %}
{% set fallback_img = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCA0MDAgMjI1Jz48cmVjdCB3aWR0aD0nNDAwJyBoZWlnaHQ9JzIyNScgZmlsbD0nJTIzZjFmM2Y1Jy8+PC9zdmc+" %}
{% set preview_name = product_name(product) %}
{% set preview_description = product_description(product) %}
<a class="back-link" href="/bar/{{ bar.id }}/categories/{{ category.id }}/products">
  <i class="bi bi-chevron-left" aria-hidden="true"></i>
  {{ _('bar_products.edit.back', default='Back to products') }}
</a>
<h1>{{ _('bar_products.edit.title', product=preview_name, default='Edit Product {product}') }}</h1>
<section class="product-edit">
  <div class="card">
    <div class="card__body">
      <form class="form" method="post" enctype="multipart/form-data">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <div class="form-field locked-field">
          <label for="name">{{ _('bar_products.form.name', default='Name') }}</label>
          <p class="description-preview">{{ preview_name }}</p>
          <input id="name" name="name" type="hidden" value="{{ product.name }}" required>
          <a class="btn-outline field-action" href="/bar/{{ bar.id }}/categories/{{ category.id }}/products/{{ product.id }}/edit/name">{{ _('bar_products.edit.actions.edit_name', default='Edit name') }}</a>
        </div>
        <div class="form-field">
          <label for="price">{{ _('bar_products.form.price', default='Price (CHF)') }}</label>
          <input id="price" type="number" step="0.01" name="price" value="{{ '%.2f'|format(product.price) }}" required>
        </div>
        <div class="form-field locked-field">
          <label for="description">{{ _('bar_products.form.description', default='Description') }}</label>
          <p class="description-preview">{{ preview_description }}</p>
          <textarea id="description" name="description" hidden maxlength="190">{{ product.description }}</textarea>
          <a class="btn-outline field-action" href="/bar/{{ bar.id }}/categories/{{ category.id }}/products/{{ product.id }}/edit/description">{{ _('bar_products.edit.actions.edit_description', default='Edit description') }}</a>
        </div>
        <div class="form-field">
          <label for="display_order">{{ _('bar_products.form.display_order', default='Display Order') }}</label>
          <input id="display_order" type="number" name="display_order" value="{{ product.display_order }}">
        </div>
        <div class="form-field">
          <label>{{ _('bar_products.form.photo', default='Photo') }}</label>
          <div class="photo-preview">
            <img src="{{ product.photo_url }}" alt="{{ preview_name }} photo" loading="lazy" decoding="async" data-fallback-src="{{ fallback_img }}" width="400" height="225" />
          </div>
          <input id="photo" type="file" name="photo" accept="image/*">
        </div>
        <button class="btn btn--primary" type="submit">{{ _('bar_products.form.update', default='Update') }}</button>
      </form>
    </div>
  </div>
</section>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="/static/js/image-fallback.js" defer></script>
{% endblock %}
