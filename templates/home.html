{% extends "layout.html" %}
{% block content %}
{% set fallback_img = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCA0MDAgMjI1Jz48cmVjdCB3aWR0aD0nNDAwJyBoZWlnaHQ9JzIyNScgZmlsbD0nJTIzZjFmM2Y1Jy8+PC9zdmc+" %}
  <section class="hero home-hero">
  <div class="hero__content container">
    <h1>{{ _('home.hero.title', default='Order drinks instantly, right from your table.') }}</h1>
    <p>{{ _('home.hero.subtitle', default='Skip the wait. Discover nearby bars and order with one tap.') }}</p>
    <div class="hero__cta">
      <a class="btn btn--primary" href="/search">{{ _('common.browse_bars', default='Browse Bars') }}</a>
    </div>
  </div>
  <img class="hero-art" src="/photo/homepage.png" alt="" aria-hidden="true" draggable="false" width="1024" height="1024" />
</section>

{% if user %}
<section class="info-section">
  <h2>{{ _('home.hero.greeting', name=user.username, default='Hi {name} ðŸ‘‹') }}</h2>
  <p>{{ _('home.hero.greeting_subtitle', default='Ready for your next drink?') }}</p>
</section>
{% endif %}

{% if recent_bars %}
<section class="bar-section">
  <div class="section-track">
    <div class="section-head">
      <h2>{{ _('home.recent.title', default='Recently visited') }}</h2>
      <div class="scroller-nav">
        <button class="scroll-btn prev" aria-label="{{ _('common.previous', default='Previous') }}">â€¹</button>
        <button class="scroll-btn next" aria-label="{{ _('common.next', default='Next') }}">â€º</button>
      </div>
    </div>
    <ul class="bars scroller">
      {% for bar in recent_bars %}
      <li>
        <a class="bar-card{% if bar.is_open_now %} is-open{% endif %}" href="/bars/{{ bar.id }}" aria-label="{{ _('home.bar_card.open_label', bar_name=bar.name, default='Open {bar_name}') }}" data-name="{{ bar.name|lower }}" data-address="{{ bar.address|lower }}" data-city="{{ bar.city|lower }}" data-state="{{ bar.state|lower }}" data-latitude="{{ bar.latitude }}" data-longitude="{{ bar.longitude }}" data-rating="{{ bar.rating or '' }}" data-distance_km="{{ bar.distance_km or '' }}" data-categories="{{ bar.bar_categories|lower if bar.bar_categories else '' }}" data-open="{{ 'true' if bar.is_open_now else 'false' }}" itemscope itemtype="https://schema.org/BarOrPub">
        <div class="thumb-wrapper">
        {% if bar.photo_url %}
        <img class="thumb" src="{{ bar.photo_url }}" alt="{{ bar.name }} photo" itemprop="image" loading="lazy" decoding="async" width="400" height="225" srcset="{{ bar.photo_url }} 400w, {{ bar.photo_url }} 800w" sizes="(max-width: 600px) 100vw, 400px" data-fallback-src="{{ fallback_img }}">
        {% else %}
        <img class="thumb" src="{{ fallback_img }}" alt="" loading="lazy" width="400" height="225">
        {% endif %}
        </div>
        {% if bar.is_open_now %}
        <span class="status status-open">{{ _('home.bar_card.status_open', default='Open now') }}</span>
        {% else %}
        <span class="status status-closed">{{ _('home.bar_card.status_closed', default='Closed now') }}</span>
        {% endif %}
        <h3 class="title" itemprop="name">{{ bar.name }}</h3>
        <div class="bar-meta">
          {% if bar.rating %}<span class="bar-rating"><i class="bi bi-star-fill" aria-hidden="true"></i> {{ '%.1f'|format(bar.rating) }}</span>{% endif %}
          <span class="bar-distance" data-has-distance="true" hidden></span>
        </div>
        <address>{{ bar.city }}{% if bar.state %}, {{ bar.state }}{% endif %}</address>
        <p class="desc">{{ bar_description(bar) }}</p>
      </a>
      </li>
      {% endfor %}
    </ul>
  </div>
</section>
{% endif %}

<section class="bar-section">
  <div class="section-track">
    <div class="section-head">
      <h2 id="bars">{{ _('home.bars.title', default='Nearby Open Bars') }}</h2>
      <div class="scroller-nav">
        <button class="scroll-btn prev" aria-label="{{ _('common.previous', default='Previous') }}">â€¹</button>
        <button class="scroll-btn next" aria-label="{{ _('common.next', default='Next') }}">â€º</button>
      </div>
    </div>
    <p id="nearestBar" aria-live="polite"></p>
    <ul class="bars scroller" id="barList">
      {% for bar in bars %}
      <li>
          <a class="bar-card{% if bar.is_open_now %} is-open{% endif %}" href="/bars/{{ bar.id }}" aria-label="{{ _('home.bar_card.open_label', bar_name=bar.name, default='Open {bar_name}') }}" data-name="{{ bar.name|lower }}" data-address="{{ bar.address|lower }}" data-city="{{ bar.city|lower }}" data-state="{{ bar.state|lower }}" data-latitude="{{ bar.latitude }}" data-longitude="{{ bar.longitude }}" data-rating="{{ bar.rating or '' }}" data-distance_km="{{ bar.distance_km or '' }}" data-categories="{{ bar.bar_categories|lower if bar.bar_categories else '' }}" data-open="{{ 'true' if bar.is_open_now else 'false' }}" itemscope itemtype="https://schema.org/BarOrPub">
        <div class="thumb-wrapper">
        {% if bar.photo_url %}
        <img class="thumb" src="{{ bar.photo_url }}" alt="{{ bar.name }} photo" itemprop="image" loading="lazy" decoding="async" width="400" height="225" srcset="{{ bar.photo_url }} 400w, {{ bar.photo_url }} 800w" sizes="(max-width: 600px) 100vw, 400px" {% if not recent_bars and loop.first %}fetchpriority="high"{% endif %} data-fallback-src="{{ fallback_img }}">
{% else %}
        <img class="thumb" src="{{ fallback_img }}" alt="" loading="lazy" width="400" height="225">
{% endif %}
        </div>
        {% if bar.is_open_now %}
        <span class="status status-open">{{ _('home.bar_card.status_open', default='Open now') }}</span>
        {% else %}
        <span class="status status-closed">{{ _('home.bar_card.status_closed', default='Closed now') }}</span>
        {% endif %}
        <h3 class="title" itemprop="name">{{ bar.name }}</h3>
        <div class="bar-meta">
          {% if bar.rating %}<span class="bar-rating"><i class="bi bi-star-fill" aria-hidden="true"></i> {{ '%.1f'|format(bar.rating) }}</span>{% endif %}
          <span class="bar-distance" data-has-distance="true" hidden></span>
        </div>
        <address>{{ bar.city }}{% if bar.state %}, {{ bar.state }}{% endif %}</address>
        <p class="desc">{{ bar_description(bar) }}</p>
      </a>
    </li>
    {% endfor %}
      <li>
        <a class="bar-card browse-bars-card" href="/search">
          <div class="thumb-wrapper">
            <i class="bi bi-arrow-left" aria-hidden="true"></i>
          </div>
          <span>{{ _('common.browse_bars', default='Browse Bars') }}</span>
        </a>
      </li>
    </ul>
    <p id="noBarsMessage" hidden>{{ _('home.bars.no_bars', default='Sorry but all bars are closed at the moment') }}</p>
  </div>
</section>

<section id="how" class="info-section">
  <h2>{{ _('home.how.title', default='How it works') }}</h2>
  <p>{{ _('home.how.body', default='Find a bar you love, take a seat, order and pay directly in the appâ€”no more waiting, no more confusion.') }}</p>
</section>

<section class="info-section">
  <h2>{{ _('home.benefits.title', default='Benefits') }}</h2>
  <ul>
    <li>{{ _('home.benefits.order', default='<strong>Order via app/web:</strong> Open, choose, and pay right from the browser.')|safe }}</li>
    <li>{{ _('home.benefits.faster', default='<strong>Faster service:</strong> Skip the counter line and track your order in real time.')|safe }}</li>
    <li>{{ _('home.benefits.menu', default='<strong>Always up-to-date menu:</strong> Variants, allergens, and live availability.')|safe }}</li>
    <li>{{ _('home.benefits.payments', default='<strong>Modern payments:</strong> Supports gateways like Twint, Apple Pay, Google Pay, and many more.')|safe }}</li>
    <li>{{ _('home.benefits.wallet', default='<strong>Wallet/Credits:</strong> Top-ups, bonuses, and quicker reorders.')|safe }}</li>
    <li>{{ _('home.benefits.multilingual', default='<strong>Multilingual:</strong> Ideal for locals and tourists.')|safe }}</li>
  </ul>
</section>

{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="/static/js/home.js" defer></script>
{% endblock %}

