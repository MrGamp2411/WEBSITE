{% extends "layout.html" %}
{% block content %}
<h1>{{ bar.name }}</h1>
<p>{{ bar.address }}, {{ bar.city }}, {{ bar.state }}</p>
{% if error %}
<p class="error">{{ error }}</p>
{% endif %}
{% for category, products in products_by_category %}
  <section class="category">
    <h2>{{ category.name }}</h2>
    <p>{{ category.description }}</p>
    {% if category.photo_url %}
    <img src="{{ category.photo_url }}" alt="{{ category.name }} photo" style="max-width:200px;"/>
    {% endif %}
    {% if user and (user.is_super_admin or (user.bar_id == bar.id and (user.is_bar_admin or user.is_bartender))) %}
    <a class="btn btn--small" href="/bar/{{ bar.id }}/categories/{{ category.id }}/edit">Edit Category</a>
    {% endif %}
    <ul class="products">
      {% for product in products %}
      <li>
        <article class="card">
          <div class="card__body">
            <h3 class="card__title">{{ product.name }}</h3>
            <p>{{ product.description }}</p>
            <p><strong>CHF {{ product.price }}</strong></p>
            {% if user %}
            <form class="form form--inline" method="post" action="/bars/{{ bar.id }}/add_to_cart">
              <input type="hidden" name="product_id" value="{{ product.id }}">
              <button class="btn btn--primary btn--small" type="submit">Add to Cart</button>
            </form>
            {% else %}
            <a class="btn" href="/login">Login to order</a>
            {% endif %}
          </div>
        </article>
      </li>
      {% endfor %}
    </ul>
  </section>
{% endfor %}
{% endblock %}
