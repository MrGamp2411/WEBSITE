{% extends "layout.html" %}
{% block page_styles %}
<link rel="stylesheet" href="/static/css/pages/admin-audit-logs.css">
{% endblock %}
{% block content %}
<section class="users-page audit-page">
  <header class="users-toolbar">
    <a class="back-link" href="/dashboard"><i class="bi bi-chevron-left" aria-hidden="true"></i> {{ _('admin_audit_logs.back', default='Back to dashboard') }}</a>
    <div class="title-wrap">
      <h1>{{ _('admin_audit_logs.title', default='Audit Logs') }}</h1>
      <p class="subtitle">{{ _('admin_audit_logs.subtitle', default='Review system activity.') }}</p>
    </div>
    <form class="users-search" method="get" id="auditFilters">
      <input name="username" type="search" placeholder="{{ _('admin_audit_logs.filters.username', default='User') }}" value="{{ filters.username or '' }}" class="audit-filters__field">
      <input name="bar" type="search" placeholder="{{ _('admin_audit_logs.filters.bar', default='Bar') }}" value="{{ filters.bar or '' }}" class="audit-filters__field">
      <select name="action" class="audit-filters__field">
        <option value="">{{ _('admin_audit_logs.filters.all_actions', default='All actions') }}</option>
        {% for a in actions %}
          <option value="{{ a }}" {% if filters.action == a %}selected{% endif %}>{{ a }}</option>
        {% endfor %}
      </select>
    </form>
  </header>
  <div class="table-card">
    <table class="users-table audit-table">
      <thead>
        <tr>
          <th>{{ _('admin_audit_logs.table.headers.time', default='Time') }}</th>
          <th>{{ _('admin_audit_logs.table.headers.user', default='User') }}</th>
          <th>{{ _('admin_audit_logs.table.headers.credit', default='Credit') }}</th>
          <th>{{ _('admin_audit_logs.table.headers.action', default='Action') }}</th>
          <th>{{ _('admin_audit_logs.table.headers.entity', default='Entity') }}</th>
          <th>{{ _('admin_audit_logs.table.headers.entity_id', default='Entity ID') }}</th>
          <th>{{ _('admin_audit_logs.table.headers.bar', default='Bar') }}</th>
          <th>{{ _('admin_audit_logs.table.headers.details', default='Details') }}</th>
        </tr>
      </thead>
      <tbody>
      {% for entry in logs %}
        <tr>
          <td>{{ entry.log.created_at|format_time }}</td>
          <td>{{ entry.user_name }}</td>
          <td>{{ '%.2f' % entry.log.actor_credit if entry.log.actor_credit is not none else '' }}</td>
          <td>{{ entry.log.action }}</td>
          <td>{{ entry.log.entity_type }}</td>
          <td>{{ entry.log.entity_id or '' }}</td>
          <td>{{ entry.bar_name }}</td>
          <td>{{ entry.payload }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="/static/js/admin-audit-logs.js" defer></script>
{% endblock %}
