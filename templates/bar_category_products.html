{% extends "layout.html" %}
{% block content %}
{% set fallback_img = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCA0MDAgMjI1Jz48cmVjdCB3aWR0aD0nNDAwJyBoZWlnaHQ9JzIyNScgZmlsbD0nJTIzZjFmM2Y1Jy8+PC9zdmc+" %}
{% set category_title = category_name(category) %}
<section class="menu-page">
  <header class="menu-toolbar">
    <div class="title-wrap">
      <h1>{{ _('bar_products.manage.title', category=category_title, bar=bar.name, default='Products in {category} for {bar}') }}</h1>
      <p class="subtitle">{{ _('bar_products.manage.subtitle', default='Add, edit and organize products for this category.') }}</p>
    </div>
    <div class="toolbar-actions">
      <a class="btn btn--primary" href="/bar/{{ bar.id }}/categories/{{ category.id }}/products/new">{{ _('bar_products.manage.actions.add', default='Add Product') }}</a>
    </div>
  </header>

  {% if products %}
  <div class="table-card">
    <table class="menu-table">
      <thead>
        <tr>
          <th>{{ _('bar_products.manage.table.headers.order', default='Order') }}</th>
          <th>{{ _('bar_products.manage.table.headers.photo', default='Photo') }}</th>
          <th>{{ _('bar_products.manage.table.headers.name', default='Name') }}</th>
          <th>{{ _('bar_products.manage.table.headers.description', default='Description') }}</th>
          <th>{{ _('bar_products.manage.table.headers.price', default='Price (CHF)') }}</th>
          <th class="actions">{{ _('bar_products.manage.table.headers.actions', default='Actions') }}</th>
        </tr>
      </thead>
      <tbody>
        {% for product in products %}
        <tr>
          <td>{{ product.display_order }}</td>
          <td>
            <img src="{{ product.photo_url }}" alt="{{ product_name(product) }} photo" width="50" height="28" loading="lazy" onerror="this.src='{{ fallback_img }}';this.onerror=null;">
          </td>
          <td>{{ product_name(product) }}</td>
          <td>{{ product_description(product) }}</td>
          <td>{{ "%.2f"|format(product.price) }}</td>
          <td class="actions">
            <div class="actions-group">
              <a class="btn-outline" href="/bar/{{ bar.id }}/categories/{{ category.id }}/products/{{ product.id }}/edit">{{ _('bar_products.manage.actions.edit', default='Edit') }}</a>
              <button type="submit" form="delete_{{ product.id }}" class="btn-danger-soft">{{ _('bar_products.manage.actions.delete', default='Delete') }}</button>
            </div>
            <form id="delete_{{ product.id }}" method="post" action="/bar/{{ bar.id }}/categories/{{ category.id }}/products/{{ product.id }}/delete" style="display:none" onsubmit="return confirm(&quot;{{ _('bar_products.manage.confirm_delete', default='Are you sure you want to delete this product?')|replace('"', '\\"') }}&quot;);"></form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <p>{{ _('bar_products.manage.empty', default='No products in this category.') }}</p>
  {% endif %}
</section>

{% endblock %}

