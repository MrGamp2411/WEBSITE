{% macro status_badge(is_open) %}
<span class="status-badge {{ 'open' if is_open else 'closed' }}">
  <span class="dot"></span>{{ 'Open now' if is_open else 'Closed now' }}
</span>
{% endmacro %}

{% macro meta(bar) %}
<div class="bar-meta">
  {% if bar.rating %}
  <span class="bar-rating"><i class="bi bi-star-fill" aria-hidden="true"></i> {{ '%.1f'|format(bar.rating) }}{% if bar.rating_count %} ({{ bar.rating_count }}){% endif %}</span>
  {% else %}
  <span class="bar-rating" data-has-rating="true" hidden></span>
  {% endif %}
  <span class="bar-distance" data-has-distance="true" hidden></span>
  {% if bar.address %}
  <a class="bar-address" href="https://maps.google.com/?q={{ bar.latitude }},{{ bar.longitude }}" target="_blank" rel="noopener"><i class="bi bi-map"></i> {{ bar.address }}</a>
  {% endif %}
</div>
{% endmacro %}

{% macro description(text) %}
<div class="bar-description">
  <p>{{ text }}</p>
  {% if text %}<button type="button" class="toggle-desc" aria-expanded="false">Mostra di più</button>{% endif %}
</div>
{% endmacro %}

{% macro opening_hours(hours) %}
{% if hours %}
<div class="opening-hours">
  {% set today = hours | selectattr('is_today') | list | first %}
  <button type="button" class="toggle-hours" aria-expanded="false">
    {% if today and today.open and today.close %}
      Oggi: {{ today.open }}–{{ today.close }}
    {% else %}
      Oggi: Closed
    {% endif %}
  </button>
  <ul>
  {% for h in hours %}
    <li class="{% if h.is_today %}today{% endif %}">{{ h.day }}:
      {% if h.open and h.close %}{{ h.open }}–{{ h.close }}{% else %}Closed{% endif %}
    </li>
  {% endfor %}
  </ul>
</div>
{% endif %}
{% endmacro %}

{% macro sticky_actions(bar) %}
<div class="sticky-actions">
  <a href="#products" class="btn btn--primary">Vedi menu</a>
  <a href="https://maps.google.com/?q={{ bar.latitude }},{{ bar.longitude }}" class="btn btn--secondary" target="_blank" rel="noopener">Indicazioni</a>
</div>
{% endmacro %}

{% macro photo_strip(photos) %}
{% if photos %}
<div class="photo-strip">
  {% for p in photos %}
    <img src="{{ p }}" alt="" loading="lazy">
  {% endfor %}
</div>
{% endif %}
{% endmacro %}
