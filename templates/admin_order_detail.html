{% extends "layout.html" %}
{% block content %}
{% set order_code = order.public_order_code or ('#' ~ order.id) %}
{% set status_label = order.status|replace('_', ' ')|title %}
<h1>{{ _('order_history.card.title', code=order_code, default='Order {code}') }}</h1>
<div class="order-list">
  <article class="order-card card card--{{ order.status|lower }}" role="article" aria-labelledby="order-{{ order.id }}-title" data-status="{{ order.status }}">
    <header class="order-card__header">
      <h3 id="order-{{ order.id }}-title">{{ _('order_history.card.title', code=order_code, default='Order {code}') }}</h3>
      <span class="order-status chip status status-{{ order.status|lower }}" aria-label="{{ _('order_history.card.status_aria', status=status_label, default='Order status: {status}') }}">{{ _('order_history.card.status_label', status=status_label, default=status_label) }}</span>
    </header>
    <div class="order-card__divider"></div>
    <section class="order-card__meta">
      <dl class="order-kv">
        <div><dt>{{ _('order_history.card.fields.total', default='Total') }}</dt><dd class="num nowrap">CHF {{ "%.2f"|format(order.total) }}</dd></div>
        {% if order.status == 'CANCELED' and order.refund_amount %}<div><dt>{{ _('order_history.card.fields.refunded', default='Refunded') }}</dt><dd class="num nowrap">CHF {{ "%.2f"|format(order.refund_amount) }}</dd></div>{% endif %}
        <div><dt>{{ _('order_history.card.fields.placed', default='Placed') }}</dt><dd class="num nowrap">{{ order.created_at|format_time }}</dd></div>

        <div><dt>{{ _('order_history.card.fields.customer', default='Customer') }}</dt><dd>{{ order.customer_name or _('order_history.card.unknown_customer', default='Unknown') }} <a href="tel:{{ (order.customer_prefix or '')|replace(' ', '') }}{{ (order.customer_phone or '')|replace(' ', '') }}">({{ order.customer_prefix or '' }} {{ order.customer_phone or '' }})</a></dd></div>
        <div><dt>{{ _('order_history.card.fields.bar', default='Bar') }}</dt><dd>{{ order.bar_name or '' }}</dd></div>

        <div><dt>{{ _('order_history.card.fields.table', default='Table') }}</dt><dd>{{ order.table_name or '' }}</dd></div>
        <div><dt>{{ _('order_history.card.fields.payment', default='Payment') }}</dt><dd>{{ order.payment_method.replace('_', ' ')|title if order.payment_method else '' }}</dd></div>
        {% if order.status == 'CANCELED' and order.cancel_reason %}<div><dt>{{ _('order_history.card.fields.cancel_reason', default='Cancellation reason') }}</dt><dd>{{ _('order_history.card.cancel_reasons.' ~ order.cancel_reason, default=order.cancel_reason|replace('_', ' ')|title) }}</dd></div>{% endif %}
        {% if order.notes %}<div><dt>{{ _('order_history.card.fields.notes', default='Notes') }}</dt><dd>{{ order.notes }}</dd></div>{% endif %}

        {% if order.ready_at %}{% set prep_minutes = ((order.ready_at - order.created_at).total_seconds() // 60)|int %}<div><dt>{{ _('order_history.card.fields.prep_time', default='Prep time') }}</dt><dd class="num">{{ _('order_history.card.prep_minutes', minutes=prep_minutes, default='{minutes} min') }}</dd></div>{% endif %}
      </dl>
    </section>
    <div class="order-card__divider"></div>
    <section class="order-card__items">
      <ul class="order-items">
        {% for item in order.items %}
        <li><span class="qty">{{ item.qty }}Ã—</span><span class="name">{{ item.menu_item_name or _('order_history.card.unknown_item', default='Unknown item') }}</span></li>
        {% endfor %}
      </ul>
    </section>
  </article>
</div>
{% endblock %}
