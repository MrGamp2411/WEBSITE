{% extends "layout.html" %}
{% block content %}
<h1>Edit Bar</h1>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<div id="map" style="height:400px;"></div>

<form class="form" method="post" action="/admin/bars/edit/{{ bar.id }}/info" enctype="multipart/form-data">
  <label for="name">Name
    <input id="name" name="name" value="{{ bar.name }}">
  </label>
  <label for="address">Address
    <input id="address" name="address" value="{{ bar.address }}">
  </label>
  <label for="city">City
    <input id="city" name="city" value="{{ bar.city }}">
  </label>
  <label for="state">State
    <input id="state" name="state" value="{{ bar.state }}">
  </label>
  <label for="description">Description
    <textarea id="description" name="description">{{ bar.description }}</textarea>
  </label>
  <label for="short_description">Short Description
    <textarea id="short_description" name="short_description">{{ bar.short_description or '' }}</textarea>
  </label>
  {% if bar.photo_url %}
  <img src="{{ bar.photo_url }}" alt="{{ bar.name }} photo" style="max-width:200px;"/>
  {% endif %}
  <label for="photo">Photo
    <input id="photo" name="photo" type="file">
  </label>
  <label for="cover_image_url">Cover Image URL
    <input id="cover_image_url" name="cover_image_url" value="{{ bar.cover_image_url or '' }}">
  </label>
  <label for="gallery_urls">Gallery URLs (comma separated)
    <input id="gallery_urls" name="gallery_urls" value="{{ bar.gallery_urls or '' }}">
  </label>
  <label for="rating">Rating
    <input id="rating" name="rating" type="number" min="0" max="5" step="0.1" value="{{ bar.rating or 0 }}">
  </label>
  <label for="is_open_now">
    <input id="is_open_now" name="is_open_now" type="checkbox" {% if bar.is_open_now %}checked{% endif %}> Open now
  </label>
  <label for="price_level">Price Level
    <input id="price_level" name="price_level" type="number" min="1" max="4" value="{{ bar.price_level or '' }}">
  </label>
  <label for="promo_label">Promo Label
    <input id="promo_label" name="promo_label" value="{{ bar.promo_label or '' }}">
  </label>
  <label for="tags">Tags
    <input id="tags" name="tags" value="{{ bar.tags or '' }}">
  </label>
  <label for="avg_prep_time_min">Avg Prep Time (min)
    <input id="avg_prep_time_min" name="avg_prep_time_min" type="number" value="{{ bar.avg_prep_time_min or '' }}">
  </label>
  <input id="latitude" name="latitude" type="hidden" value="{{ bar.latitude }}">
  <input id="longitude" name="longitude" type="hidden" value="{{ bar.longitude }}">
  <button class="btn btn--primary" type="submit">Save</button>
</form>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const initialLat = {{ bar.latitude }};
  const initialLng = {{ bar.longitude }};
  const map = L.map('map').setView([initialLat, initialLng], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: 'Â© OpenStreetMap contributors'
  }).addTo(map);
  const marker = L.marker([initialLat, initialLng], {draggable:true}).addTo(map);
  function updateInputs(e) {
    const pos = e.target.getLatLng();
    document.getElementById('latitude').value = pos.lat.toFixed(6);
    document.getElementById('longitude').value = pos.lng.toFixed(6);
  }
  marker.on('dragend', updateInputs);
  updateInputs({target: marker});
</script>
{% endblock %}

