{% extends "layout.html" %}
{% block page_styles %}
{{ super() }}
<link rel="stylesheet" href="/static/css/pages/admin-edit-welcome.css">
{% endblock %}
{% block content %}
{% set subject_map = subject_translations if subject_translations is defined else {} %}
{% set body_map = body_translations if body_translations is defined else {} %}
<section class="users-page">
  <header class="users-toolbar">
    <a class="back-link" href="/admin/notifications"><i class="bi bi-chevron-left" aria-hidden="true"></i> {{ _('admin_edit_welcome.back', default='Back to notifications') }}</a>
    <div class="title-wrap">
      <h1>{{ _('admin_edit_welcome.title', default='Edit Welcome Message') }}</h1>
    </div>
  </header>
  {% if error %}
  <p class="alert-danger">{{ error }}</p>
  {% endif %}
  <form class="form" method="post" action="/admin/notifications/welcome">
    {% set default_lang = (available_languages | selectattr('code', 'equalto', default_language) | list | first) %}
    <div class="field-group">
      <p class="translation-label">{{ _('admin_edit_welcome.form.subject', default='Subject') }}</p>
    </div>
    <div id="subjectTranslations" class="translation-panel">
      <p class="translation-help">{{ _('admin_edit_welcome.form.subject_translation_help', default='Provide a subject for every supported language.') }}</p>
      <p class="translation-note">{{ _('admin_edit_welcome.form.subject_default_language_help', language=(default_lang.name if default_lang else default_language|upper), default='Provide the {language} subject. Other languages inherit it when no translation is set.') }}</p>
      {% for lang in available_languages %}
      <label for="subject_{{ lang.code }}">{{ _('admin_edit_welcome.form.language_subject_label', language=lang.name, default='{language} subject') }}
        <input id="subject_{{ lang.code }}" name="subject_{{ lang.code }}" value="{{ subject_map.get(lang.code, subject) }}" maxlength="30"{% if lang.code == default_language %} required aria-required="true"{% endif %}>
      </label>
      {% endfor %}
    </div>
    <div class="field-group">
      <p class="translation-label">{{ _('admin_edit_welcome.form.message', default='Message') }}</p>
    </div>
    <div id="bodyTranslations" class="translation-panel">
      <p class="translation-help">{{ _('admin_edit_welcome.form.message_translation_help', default='Write the welcome message in each supported language.') }}</p>
      <p class="translation-note">{{ _('admin_edit_welcome.form.message_default_language_help', language=(default_lang.name if default_lang else default_language|upper), default='Provide the {language} message. Other languages inherit it when no translation is set.') }}</p>
      {% for lang in available_languages %}
      <label for="body_{{ lang.code }}">{{ _('admin_edit_welcome.form.language_message_label', language=lang.name, default='{language} message') }}
        <textarea id="body_{{ lang.code }}" name="body_{{ lang.code }}"{% if lang.code == default_language %} required aria-required="true"{% endif %}>{{ body_map.get(lang.code, body) }}</textarea>
      </label>
      {% endfor %}
    </div>
    <button class="btn btn--primary" type="submit">{{ _('admin_edit_welcome.form.save', default='Save') }}</button>
  </form>
</section>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="/static/js/admin-edit-welcome.js" defer></script>
{% endblock %}
