{% extends "layout.html" %}
{% block content %}
<div class="auth-card">
  <h1>Profile</h1>
  {% if error %}<p class="alert">{{ error }}</p>{% endif %}
  <form method="post" action="/profile">
    <label for="username" class="edit-field">Username
      <input id="username" type="text" name="username" required autocomplete="username" inputmode="text" enterkeyhint="next" minlength="3" maxlength="24" pattern="(?![._-])(?!.*[._-]{2})(?!.*[._-]$)[a-z0-9._-]{3,24}" title="3â€“24 characters, lowercase letters, numbers, dot, hyphen or underscore. No spaces." value="{{ username|default(user.username) }}">
      <button type="button" class="btn-icon edit-btn" aria-label="Edit username"><i class="bi bi-pencil-square"></i></button>
    </label>
    <label for="email" class="edit-field">Email
      <input id="email" type="email" name="email" required autocomplete="email" inputmode="email" enterkeyhint="next" pattern="[^@]+@[^@]+\.[^@]+" title="Email must be in the format text@text.text" value="{{ email|default(user.email) }}">
      <button type="button" class="btn-icon edit-btn" aria-label="Edit email"><i class="bi bi-pencil-square"></i></button>
    </label>
    <label for="current_password" class="edit-field">Current Password
      <div class="password-wrapper">
        <input id="current_password" type="password" name="current_password" autocomplete="current-password" enterkeyhint="next" minlength="8" maxlength="128" title="Password must be between 8 and 128 characters">
        <button type="button" class="toggle-password" aria-label="Show password"><i class="bi bi-eye"></i></button>
      </div>
      <span id="capsWarningCurrent" class="caps-warning" hidden>Caps Lock is on</span>
      <button type="button" class="btn-icon edit-btn" aria-label="Edit current password"><i class="bi bi-pencil-square"></i></button>
    </label>
    <label for="password" class="edit-field">New Password
      <div class="password-wrapper">
        <input id="password" type="password" name="password" autocomplete="new-password" enterkeyhint="next" minlength="8" maxlength="128" title="Password must be between 8 and 128 characters">
        <button type="button" class="toggle-password" aria-label="Show password"><i class="bi bi-eye"></i></button>
      </div>
      <span id="capsWarning" class="caps-warning" hidden>Caps Lock is on</span>
      <button type="button" class="btn-icon edit-btn" aria-label="Edit new password"><i class="bi bi-pencil-square"></i></button>
    </label>
    <label for="confirm_password" class="edit-field">Confirm Password
      <div class="password-wrapper">
        <input id="confirm_password" type="password" name="confirm_password" autocomplete="new-password" enterkeyhint="next" minlength="8" maxlength="128" title="Passwords must match">
        <button type="button" class="toggle-password" aria-label="Show password"><i class="bi bi-eye"></i></button>
      </div>
      <span id="capsWarningConfirm" class="caps-warning" hidden>Caps Lock is on</span>
      <button type="button" class="btn-icon edit-btn" aria-label="Edit confirm password"><i class="bi bi-pencil-square"></i></button>
    </label>
    <label for="prefix" class="edit-field">Phone Prefix
      <select id="prefix" name="prefix" required autocomplete="tel-country-code">
        <option value="+41" {% if (prefix|default(user.prefix)) == "+41" %}selected{% endif %}>+41 (Switzerland)</option>
        <option value="+1" {% if (prefix|default(user.prefix)) == "+1" %}selected{% endif %}>+1 (USA)</option>
        <option value="+44" {% if (prefix|default(user.prefix)) == "+44" %}selected{% endif %}>+44 (UK)</option>
      </select>
      <button type="button" class="btn-icon edit-btn" aria-label="Edit phone prefix"><i class="bi bi-pencil-square"></i></button>
    </label>
    <label for="phone" class="edit-field">Phone Number
      <input id="phone" type="tel" name="phone" required autocomplete="tel-national" inputmode="tel" enterkeyhint="done" pattern="[0-9]{9,10}" minlength="9" maxlength="10" title="Phone number must be 9 to 10 digits" value="{{ phone|default(user.phone) }}">
      <button type="button" class="btn-icon edit-btn" aria-label="Edit phone number"><i class="bi bi-pencil-square"></i></button>
    </label>
    <button class="btn btn--primary" type="submit">Save</button>
  </form>
  <style>
    .auth-card label.edit-field{position:relative;padding-right:40px;}
    .auth-card label.edit-field .edit-btn{position:absolute;top:0;right:0;border:0;background:transparent;cursor:pointer;}
  </style>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/password.js" defer></script>
{% endblock %}

