{% extends "layout.html" %}
{% block content %}
<h1>Create New Bar</h1>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<div id="map" style="height:400px;"></div>

<form class="form" method="post" action="/admin/bars/new" enctype="multipart/form-data">
  <label for="name">Name
    <input id="name" type="text" name="name" required>
  </label>
  <label for="address">Address
    <input id="address" type="text" name="address" required>
  </label>
  <label for="city">City
    <input id="city" type="text" name="city" required>
  </label>
  <label for="state">State
    <input id="state" type="text" name="state" required>
  </label>
  <label for="description">Description
    <textarea id="description" name="description" required maxlength="120"></textarea>
  </label>
  <label for="photo">Photo
    <input id="photo" type="file" name="photo">
  </label>
  <label for="manual_closed">
    <input id="manual_closed" name="manual_closed" type="checkbox"> Close bar manually
  </label>
  {% set days = ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'] %}
  <table class="opening-hours">
    <thead>
      <tr><th>Day</th><th>Open</th><th>Close</th></tr>
    </thead>
    <tbody>
    {% for day in days %}
      {% set idx = loop.index0 %}
      <tr>
        <td>{{ day }}</td>
        <td><input type="time" name="open_{{ idx }}"></td>
        <td><input type="time" name="close_{{ idx }}"></td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  <input id="latitude" type="hidden" name="latitude" required>
  <input id="longitude" type="hidden" name="longitude" required>
  <button class="btn btn--primary" type="submit">Create Bar</button>
</form>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const initialLat = 45.4642;
  const initialLng = 9.1900;
  const map = L.map('map').setView([initialLat, initialLng], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: 'Â© OpenStreetMap contributors'
  }).addTo(map);
  const marker = L.marker([initialLat, initialLng], {draggable:true}).addTo(map);
  function updateInputs(e) {
    const pos = e.target.getLatLng();
    document.getElementById('latitude').value = pos.lat.toFixed(6);
    document.getElementById('longitude').value = pos.lng.toFixed(6);
  }
  marker.on('dragend', updateInputs);
  updateInputs({target: marker});
</script>
{% endblock %}

