document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".navbar");if(e){const t=()=>e.classList.toggle("is-scrolled",window.scrollY>8);t(),window.addEventListener("scroll",t,{passive:!0})}const t=document.getElementById("barSearch")||document.getElementById("barSearchDesktop"),n=document.getElementById("barList"),o=document.getElementById("nearestBar"),a=document.getElementById("locationInput")||document.getElementById("locationInputDesktop"),s=document.getElementById("searchSuggestions")||document.getElementById("searchSuggestionsDesktop"),i=document.querySelectorAll(".location-selector");i.length&&a&&i.forEach(e=>{e.addEventListener("click",()=>{a.value="",a.focus(),a.dispatchEvent(new Event("input"))})});const d=document.querySelector(".location-pill");if(d&&a){const e=()=>{d.textContent=`ðŸ“ ${a.value}`};e(),["input","change"].forEach(t=>a.addEventListener(t,e)),setTimeout(e,1e3)}function r(e){if(!s)return;const t=e.trim();if(!t)return s.innerHTML="",void s.classList.remove("show");fetch(`/api/search?q=${encodeURIComponent(t)}`).then(e=>e.json()).then(e=>function(e){if(!s)return;if(!e.length)return s.innerHTML="",void s.classList.remove("show");const t=e.map(e=>`\n      <li data-bar-id="${e.id}">\n        <article class="card" itemscope itemtype="https://schema.org/BarOrPub">\n          <img class="card__media" src="https://source.unsplash.com/random/400x250?bar,${e.id}" alt="${e.name}" itemprop="image" loading="lazy" decoding="async" width="400" height="250">\n          <div class="card__body">\n            <h3 class="card__title" itemprop="name">${e.name}</h3>\n            <p class="card__desc">${e.description}</p>\n            <address itemprop="address">${e.address}, ${e.city}, ${e.state}</address>\n            <a class="btn btn--primary" href="/bars/${e.id}">View Menu</a>\n          </div>\n        </article>\n      </li>\n    `).join("");s.innerHTML=`<ul class="bars">${t}</ul>`,s.classList.add("show")}(e.bars.slice(0,5)))}t&&(t.addEventListener("focus",()=>{t.classList.add("expanded")}),t.addEventListener("input",()=>{n&&function(e){if(!n)return;const t=e.toLowerCase();n.querySelectorAll("li").forEach(e=>{const{name:n,address:o,city:a="",state:s=""}=e.dataset;e.style.display=n.includes(t)||o.includes(t)||a.includes(t)||s.includes(t)?"":"none"})}(t.value),r(t.value)}),t.addEventListener("blur",()=>{setTimeout(()=>{""===t.value.trim()&&t.classList.remove("expanded"),s&&s.classList.remove("show")},100)}),t.addEventListener("keydown",e=>{"Enter"===e.key&&(e.preventDefault(),window.location.href=`/search?q=${encodeURIComponent(t.value)}`)})),s&&s.addEventListener("click",e=>{const t=e.target.closest("li[data-bar-id]");if(t){const e=t.getAttribute("data-bar-id");window.location.href=`/bars/${e}`}});const c=document.querySelectorAll("ul.bars li");function l(e,t){if(c.forEach(n=>{const o=parseFloat(n.dataset.latitude),a=parseFloat(n.dataset.longitude);if(!isFinite(o)||!isFinite(a))return;const s=function(e,t,n,o){const a=e=>e*Math.PI/180,s=6371,i=a(n-e),d=a(o-t),r=Math.sin(i/2)**2+Math.cos(a(e))*Math.cos(a(n))*Math.sin(d/2)**2,c=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r));return s*c}(e,t,o,a);n.dataset.distance=s;const i=n.querySelector(".distance");if(i){const e=document.createElement("a");e.textContent=`ðŸ“ ${s.toFixed(1)} km away`,e.href="#",e.addEventListener("click",e=>{e.preventDefault();const t=/iPad|iPhone|Mac/i.test(navigator.platform)?`https://maps.apple.com/?daddr=${o},${a}`:`https://www.google.com/maps/dir/?api=1&destination=${o},${a}`;window.open(t,"_blank")}),i.innerHTML="",i.appendChild(e)}}),n){const e=Array.from(n.querySelectorAll("li")).filter(e=>"none"!==e.style.display);if(e.sort((e,t)=>parseFloat(e.dataset.distance)-parseFloat(t.dataset.distance)),e.forEach(e=>n.appendChild(e)),o&&e.length){const t=e[0],n=t.querySelector(".card__title").textContent;o.textContent=`Nearest bar: ${n} (${parseFloat(t.dataset.distance).toFixed(1)} km)`}}}function u(e,t,n){l(e,t),a&&(a.value=n||`${e.toFixed(3)}, ${t.toFixed(3)}`),function(e,t){fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${t}`).then(e=>e.json()).then(n=>{if(a){if(n.address){const{city:e,town:t,village:o,postcode:s}=n.address,i=e||t||o;if(i)return void(a.value=s?`${i} ${s}`:i)}a.value=n.display_name||`${e.toFixed(3)}, ${t.toFixed(3)}`}}).catch(()=>{a&&(a.value=`${e.toFixed(3)}, ${t.toFixed(3)}`)})}(e,t)}if(c.length){navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{const{latitude:t,longitude:n}=e.coords;u(t,n)}),a&&a.addEventListener("keydown",e=>{if("Enter"===e.key){const e=a.value.trim();e&&function(e){fetch(`https://nominatim.openstreetmap.org/search?format=json&limit=1&q=${encodeURIComponent(e)}`).then(e=>e.json()).then(t=>{if(t&&t.length){const{lat:n,lon:o}=t[0];u(parseFloat(n),parseFloat(o),e)}})}(e)}})}const m=document.getElementById("themeToggle");if(m){const e=e=>{document.body.classList.toggle("dark-mode","dark"===e),m.textContent="dark"===e?"â˜€ï¸":"ðŸŒ™",m.setAttribute("aria-label","dark"===e?"Switch to light mode":"Switch to dark mode")};m.addEventListener("click",()=>{const t=document.body.classList.contains("dark-mode")?"light":"dark";e(t),localStorage.setItem("theme",t)});const t=localStorage.getItem("theme")||"light";e(t)}const h=document.querySelectorAll(".js-open-menu"),p=document.getElementById("mobileMenu"),f=document.querySelector(".menu-backdrop");let v,y;function g(){v&&v.setAttribute("aria-expanded","false"),p.classList.remove("open"),f.classList.remove("show"),document.body.style.overflow="",p.hidden=!0,f.hidden=!0,y&&y.focus()}h.forEach(e=>{e.addEventListener("click",()=>{"true"===e.getAttribute("aria-expanded")?g():function(e){v=e,y=document.activeElement,v.setAttribute("aria-expanded","true"),p.hidden=!1,f.hidden=!1,requestAnimationFrame(()=>{p.classList.add("open"),f.classList.add("show")}),document.body.style.overflow="hidden";const t=p.querySelector('[role="menuitem"]');t&&t.focus()}(e)})}),f?.addEventListener("click",g),document.addEventListener("keydown",e=>{"Escape"!==e.key||p.hidden||g()}),p?.addEventListener("click",e=>{e.target.closest('[role="menuitem"]')&&g()}),p?.addEventListener("keydown",e=>{if("Tab"!==e.key)return;const t=p.querySelectorAll('[role="menuitem"]');if(!t.length)return;const n=t[0],o=t[t.length-1];e.shiftKey&&document.activeElement===n?(e.preventDefault(),o.focus()):e.shiftKey||document.activeElement!==o||(e.preventDefault(),n.focus())}),document.querySelector(".js-open-search")?.addEventListener("click",()=>{const e=document.querySelector(".search-overlay");e?.classList.add("open"),e?.removeAttribute("hidden")}),document.querySelector(".overlay-close")?.addEventListener("click",()=>{const e=document.querySelector(".search-overlay");e?.classList.remove("open"),e?.setAttribute("hidden","")})});