document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector(".navbar");if(e){const t=()=>e.classList.toggle("is-scrolled",window.scrollY>8);t(),window.addEventListener("scroll",t,{passive:!0})}const t=window.matchMedia("(max-width: 768px)").matches,n=t?document.getElementById("barSearch"):document.getElementById("barSearchDesktop"),a=document.getElementById("barList"),o=document.getElementById("nearestBar"),s=t?document.getElementById("locationInput"):document.getElementById("locationInputDesktop"),i=t?document.getElementById("searchSuggestions"):document.getElementById("searchSuggestionsDesktop"),d=document.querySelectorAll(".location-selector");d.length&&s&&d.forEach(e=>{e.addEventListener("click",()=>{s.focus(),s.select()})});const r=document.querySelector(".location-pill");if(r&&s){const e=()=>{r.textContent=`📍 ${s.value}`};e(),["input","change"].forEach(t=>s.addEventListener(t,e)),setTimeout(e,1e3)}function c(e){if(!i)return;const t=e.trim();if(!t)return i.innerHTML="",void i.classList.remove("show");fetch(`/api/search?q=${encodeURIComponent(t)}`).then(e=>e.json()).then(e=>function(e){if(!i)return;if(!e.length)return i.innerHTML="",void i.classList.remove("show");const t=e.map(e=>`\n      <li data-bar-id="${e.id}">\n        <article class="card" itemscope itemtype="https://schema.org/BarOrPub">\n          <img class="card__media" src="https://source.unsplash.com/random/400x250?bar,${e.id}" alt="${e.name}" itemprop="image" loading="lazy" decoding="async" width="400" height="250">\n          <div class="card__body">\n            <h3 class="card__title" itemprop="name">${e.name}</h3>\n            <p class="card__desc">${e.description}</p>\n            <address itemprop="address">${e.address}, ${e.city}, ${e.state}</address>\n            <a class="btn btn--primary" href="/bars/${e.id}">View Menu</a>\n          </div>\n        </article>\n      </li>\n    `).join("");i.innerHTML=`<ul class="bars">${t}</ul>`,i.classList.add("show")}(e.bars.slice(0,5)))}n&&(n.addEventListener("focus",()=>{n.classList.add("expanded")}),n.addEventListener("input",()=>{a&&function(e){if(!a)return;const t=e.toLowerCase();a.querySelectorAll("li").forEach(e=>{const{name:n,address:a,city:o="",state:s=""}=e.dataset;e.style.display=n.includes(t)||a.includes(t)||o.includes(t)||s.includes(t)?"":"none"})}(n.value),c(n.value)}),n.addEventListener("blur",()=>{setTimeout(()=>{""===n.value.trim()&&n.classList.remove("expanded"),i&&i.classList.remove("show")},100)}),n.addEventListener("keydown",e=>{"Enter"===e.key&&(e.preventDefault(),window.location.href=`/search?q=${encodeURIComponent(n.value)}`)})),i&&i.addEventListener("click",e=>{const t=e.target.closest("li[data-bar-id]");if(t){const e=t.getAttribute("data-bar-id");window.location.href=`/bars/${e}`}});const l=document.querySelectorAll("ul.bars li");function u(e,t){if(l.forEach(n=>{const a=parseFloat(n.dataset.latitude),o=parseFloat(n.dataset.longitude);if(!isFinite(a)||!isFinite(o))return;const s=function(e,t,n,a){const o=e=>e*Math.PI/180,s=6371,i=o(n-e),d=o(a-t),r=Math.sin(i/2)**2+Math.cos(o(e))*Math.cos(o(n))*Math.sin(d/2)**2,c=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r));return s*c}(e,t,a,o);n.dataset.distance=s;const i=n.querySelector(".distance");if(i){const e=document.createElement("a");e.textContent=`📍 ${s.toFixed(1)} km away`,e.href="#",e.addEventListener("click",e=>{e.preventDefault();const t=/iPad|iPhone|Mac/i.test(navigator.platform)?`https://maps.apple.com/?daddr=${a},${o}`:`https://www.google.com/maps/dir/?api=1&destination=${a},${o}`;window.open(t,"_blank")}),i.innerHTML="",i.appendChild(e)}}),a){const e=Array.from(a.querySelectorAll("li")).filter(e=>"none"!==e.style.display);if(e.sort((e,t)=>parseFloat(e.dataset.distance)-parseFloat(t.dataset.distance)),e.forEach(e=>a.appendChild(e)),o&&e.length){const t=e[0],n=t.querySelector(".card__title").textContent;o.textContent=`Nearest bar: ${n} (${parseFloat(t.dataset.distance).toFixed(1)} km)`}}}function m(e,t,n){u(e,t),s&&(s.value=n||`${e.toFixed(3)}, ${t.toFixed(3)}`),function(e,t){fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${t}`).then(e=>e.json()).then(n=>{if(s){if(n.address){const{city:e,town:t,village:a,postcode:o}=n.address,i=e||t||a;if(i)return void(s.value=o?`${i} ${o}`:i)}s.value=n.display_name||`${e.toFixed(3)}, ${t.toFixed(3)}`}}).catch(()=>{s&&(s.value=`${e.toFixed(3)}, ${t.toFixed(3)}`)})}(e,t)}if(l.length){navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{const{latitude:t,longitude:n}=e.coords;m(t,n)}),s&&s.addEventListener("keydown",e=>{if("Enter"===e.key){const e=s.value.trim();e&&function(e){fetch(`https://nominatim.openstreetmap.org/search?format=json&limit=1&q=${encodeURIComponent(e)}`).then(e=>e.json()).then(t=>{if(t&&t.length){const{lat:n,lon:a}=t[0];m(parseFloat(n),parseFloat(a),e)}})}(e)}})}const h=document.getElementById("themeToggle");if(h){const e=e=>{document.body.classList.toggle("dark-mode","dark"===e),h.textContent="dark"===e?"☀️":"🌙",h.setAttribute("aria-label","dark"===e?"Switch to light mode":"Switch to dark mode")};h.addEventListener("click",()=>{const t=document.body.classList.contains("dark-mode")?"light":"dark";e(t),localStorage.setItem("theme",t)});const t=localStorage.getItem("theme")||"light";e(t)}const p=document.getElementById("menuToggle"),g=document.getElementById("mobileMenu");p&&g&&p.addEventListener("click",()=>{const e="true"===p.getAttribute("aria-expanded");p.setAttribute("aria-expanded",String(!e)),g.hidden=e,g.classList.toggle("open",!e)}),document.querySelector(".js-open-search")?.addEventListener("click",()=>{const e=document.querySelector(".search-overlay");e?.classList.add("open"),e?.removeAttribute("hidden")}),document.querySelector(".overlay-close")?.addEventListener("click",()=>{const e=document.querySelector(".search-overlay");e?.classList.remove("open"),e?.setAttribute("hidden","")})});